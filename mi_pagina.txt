import React, { useState, useEffect } from 'react';
import { ShoppingCart, Menu, X, Phone, MapPin, Egg, Bird, Star, Trash2, Plus, Minus, Settings, ToggleLeft, ToggleRight, Instagram } from 'lucide-react';
// IMPORTACIONES DE FIREBASE
import { initializeApp } from 'firebase/app';
import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged } from 'firebase/auth';
import { getFirestore, doc, setDoc, onSnapshot, collection, serverTimestamp, setLogLevel } from 'firebase/firestore';


// --- CONFIGURACIÓN DE LA APP ---
const WHATSAPP_NUMBER = "5492215344675"; 
const USER_LOGO_UPLOADED_ID = "uploaded:Logo para granjaMuny.png-5bd2db0a-e76f-4825-9ce2-3fe18d7e49b1";
const USER_LOGO_EXTERNAL_URL = "https://i.pinimg.com/736x/ad/e2/29/ade2291a3bef37b5b03deaa55b9625fd.jpg";

// Datos de ejemplo para los productos (¡Ahora solo los que NO son 'huevos' tienen galería!)
const PRODUCTS_DATA = [
  {
    id: 1,
    name: "Pigmeo",
    category: "gallos",
    price: 15000,
    description: "Perfecta tanto como mascota de granja como para producción de huevos en poca escala.",
    fullDescription: "El gallo Pigmeo es un ejemplar de tamaño reducido, ideal para quienes buscan una mascota de compañía o para la crianza en espacios limitados. Su carácter dócil y fácil manejo lo convierten en una opción excelente. Además de su atractivo visual, contribuye a una producción de huevos familiar a pequeña escala, destacando por su resistencia y longevidad. Es un ave perfecta para iniciarse en la avicultura.",
    image: "https://i.ibb.co/Nd2jSbNK/Dise-o-sin-t-tulo.png",
    images: [
      "https://i.ibb.co/Nd2jSbNK/Dise-o-sin-t-tulo.png", 
      "https://i.ibb.co/whpsz2hJ/Dise-o-sin-t-tulo-fotor-enhance-20251128133355.jpg", 
      "https://i.ibb.co/NggndwK4/ef539c07-61ec-4c85-9ea4-848a843faaed.jpg"
          ]
  },
  {
    id: 2,
    name: "Leghorn",
    category: "gallinas",
    price: 16500,
    description: "Raza italiana conocida por su elegancia, energía y gran capacidad ponedora.",
    fullDescription: "La gallina Leghorn, originaria de la región de la Toscana en Italia, es mundialmente famosa por ser una de las mejores ponedoras de huevos blancos. Es un ave de temperamento enérgico y activo, que disfruta del pastoreo libre. A pesar de su nerviosismo, es una raza resistente y muy eficiente para la producción intensiva y semi-intensiva, con un bajo consumo de alimento y una producción sostenida a lo largo del año.",
    image: "https://i.ibb.co/spwHxK6N/leghorn.png",
    images: [
        "https://i.ibb.co/spwHxK6N/leghorn.png",
        "https://i.ibb.co/mVvwVZLd/175361382-white-broiler-chicken-looking-curiously-at-the-camera-processed-lightpdf-com.png",
        "https://i.ibb.co/dsY0pnNs/186218025-a-chicken-sunset-on-a-sunny-day-chickens-feed-in-a-traditional-farmyard-detail-of-a-chicke.png"
            ]
  },
  {
    id: 3,
    name: "Rhode Island Red",
    category: "gallinas",
    price: 20000,
    description: "Fuerte, fértil y de excelente linaje.",
    fullDescription: "La Rhode Island Red es una raza de doble propósito, valorada tanto por su producción de huevos marrones de gran tamaño como por su calidad de carne. Son aves robustas, de crecimiento rápido y con una gran adaptabilidad a diversos climas. Su temperamento es tranquilo, lo que facilita su manejo en el criadero y las hace una opción muy popular entre criadores experimentados y principiantes que buscan un rendimiento consistente.",
    image: "https://i.ibb.co/60bzFXtK/Dise-o-sin-t-tulo-1.png",
    images: [
        "https://i.ibb.co/60bzFXtK/Dise-o-sin-t-tulo-1.png",
        "https://i.ibb.co/XxRJwQ20/Captura-de-pantalla-2025-11-30-222106-1.jpg"
            ]
  },
  // PRODUCTO DE HUEVOS - SIN GALERÍA ADICIONAL
  {
    id: 4,
    name: "Maple de Huevos (30u)",
    category: "huevos",
    price: 10000,
    description: "Maple económico familiar. Frescos del día.",
    fullDescription: "Un maple de 30 unidades de huevos frescos, recolectados diariamente en nuestra granja. Ideales para el consumo familiar o pequeños negocios. Nuestras gallinas son alimentadas con granos naturales, lo que garantiza un alto valor nutricional y un sabor superior. Disfrute de la calidad de un huevo campero.",
    image: "https://images.unsplash.com/photo-1506976785307-8732e854ad03?auto=format&fit=crop&q=80&w=500",
    images: ["https://images.unsplash.com/photo-1506976785307-8732e854ad03?auto=format&fit=crop&q=80&w=500"] // Solo la imagen principal
  },
  {
    id: 5,
    name: "Leghorn",
    category: "gallos",
    price: 20000,
    description: "Raza muy resistente y adaptable, capaz de prosperar tanto en criaderos amplios como en espacios más reducidos.",
    fullDescription: "El gallo Leghorn es un animal vigoroso y de excelente porte. Su linaje genético asegura la vitalidad de la parvada y la cría de futuras generaciones de gallinas altamente ponedoras. Es resistente a enfermedades comunes y se adapta bien a diferentes condiciones climáticas y de manejo. Un semental fundamental para un criadero productivo.",
    image: "https://i.ibb.co/hxbNt6bL/Dise-o-sin-t-tulo-1.png",
    images: [
        "https://i.ibb.co/hxbNt6bL/Dise-o-sin-t-tulo-1.png",
        "https://i.ibb.co/TpQm3TK/remove-watermark-image-20251130-222717.png"
            ]
  },
  {
    id: 6,
    name: "Leghorn",
    category: "pollitos",
    price: 10000,
    description: "Pollitos de 1 día, sexados. Mixtos camperos.",
    fullDescription: "Pollitos de la raza Leghorn de tan solo un día de edad, sexados para asegurar la proporción deseada en tu granja. Su genética de alto rendimiento garantiza que serán excelentes ponedoras en el futuro. Ideales para iniciar o renovar tu parvada de producción de huevos.",
    image: "https://i.ibb.co/HfvR93fB/Dise-o-sin-t-tulo.png",
    images: [
        "https://i.ibb.co/HfvR93fB/Dise-o-sin-t-tulo.png",
        ]
  },
  {
    id: 7,
    name: "Marans",
    category: "gallinas",
    price: 15000,
    description: "Ave robusta, tranquila y resistente, con plumaje denso y elegante.",
    fullDescription: "La gallina Marans es conocida como la 'gallina de los huevos de oro' debido a la pigmentación oscura y brillante de sus cáscaras. Es un ave de doble propósito: excelente ponedora y de buen desarrollo cárnico. Su carácter es dócil y se adapta bien al pastoreo libre, siendo muy resistente a las inclemencias del tiempo. Su plumaje denso le da un aspecto muy elegante.",
    image: "https://i.ibb.co/5VG0fZt/wmremove-transformed.png",
    images: [
        "https://i.ibb.co/5VG0fZt/wmremove-transformed.png",
        "https://i.ibb.co/dxfstsV/remove-watermark-image-20251130-221403.png"
            ]
  },
  {
    id: 8,
    name: "Guinea",
    category: "gallinas",
    price: 5000,
    description: "Gallina exotica.",
    fullDescription: "La gallina de Guinea, originaria de África, es una adición exótica y muy útil para cualquier granja. Son conocidas por su fuerte llamado que sirve como alarma contra depredadores y por su habilidad para controlar plagas de insectos y garrapatas de forma natural. Requieren poco cuidado y son extremadamente resistentes y autosuficientes. Un excelente 'vigilante' para tu criadero.",
    image: "https://i.ibb.co/rGgZqxpT/Dise-o-sin-t-tulo.png",
    images: [
        "https://i.ibb.co/rGgZqxpT/Dise-o-sin-t-tulo.png",
        "https://i.ibb.co/0pmsd9k0/aves-de-guinea-200816-f65fdc1a-817c-46c6-80a2-3e211aeae882.jpg"
        ]
  },
  {
    id: 9,
    name: "Marans",
    category: "gallos",
    price: 20000,
    description: "Buena salud y excelente genética, ideal para cualquier criadero.",
    fullDescription: "Gallo de la raza Marans, un semental de carácter tranquilo y excelente linaje. Es fundamental para la reproducción de gallinas que ponen los codiciados huevos chocolate. Su fuerte constitución física y resistencia lo hacen ideal para mantener una parvada saludable. Se adapta bien a climas templados y fríos.",
    image: "https://i.ibb.co/rRw4N80j/Dise-o-sin-t-tulo-1-artguru.jpg",
    images: [
        "https://i.ibb.co/rRw4N80j/Dise-o-sin-t-tulo-1-artguru.jpg",
        "https://i.ibb.co/TD6d3P3F/pollo-de-welsummer-29625993-e637cdda-c262-4b94-ad59-912060588cd7.jpg"
            ]
  },
  {
    id: 10,
    name: "Rhode Island Red",
    category: "gallos",
    price: 25000,
    description: "Raza confiable para mejorar cualquier producción.",
    fullDescription: "Gallo Rhode Island Red, un ejemplar fuerte y dominante, ideal para mantener el orden en el criadero y asegurar la fertilidad de los huevos. Su robustez y adaptabilidad al clima lo convierten en una inversión segura para mejorar la genética y la producción de huevos y carne en tu granja.",
    image: "https://i.ibb.co/tMv2qvKM/Dise-o-sin-t-tulo-2-artguru.jpg",
    images: [
        "https://i.ibb.co/tMv2qvKM/Dise-o-sin-t-tulo-2-artguru.jpg",
        "https://i.ibb.co/hJtHkyxb/gallo-del-rojo-de-rhode-island-3421089-e2b8dc8a-1760-4ba4-b8fd-b46a0590714e.jpg"
            ]
  },
  {
    id: 11,
    name: "Rhode Island Red",
    category: "pollitos",
    price: 12000,
    description: "Pollitos de 1 día, sexados. Mixtos camperos.",
    fullDescription: "Pollitos de la raza Rhode Island Red de un día, sexados, provenientes de líneas de doble propósito. Tienen un rápido crecimiento y muestran una gran capacidad de adaptación desde temprana edad.",
    image: "https://i.ibb.co/svssWbjM/Dise-o-sin-t-tulo-artguru.jpg",
    images: [
        "https://i.ibb.co/svssWbjM/Dise-o-sin-t-tulo-artguru.jpg",
            ]
  },
  {
    id: 12,
    name: "Marans",
    category: "pollitos",
    price: 12000,
    description: "Pollitos de 1 día, sexados. Mixtos camperos.",
    fullDescription: "Pollitos Marans de un día, sexados. Son pequeños y robustos, con el potencial de convertirse en aves de plumaje elegante y excelentes ponedoras de huevos oscuros, característicos de la raza. Cuidado inicial sencillo y gran rusticidad.",
    image: "https://i.ibb.co/kgfRf01k/Dise-o-sin-t-tulo-1.png",
    images: [
        "https://i.ibb.co/kgfRf01k/Dise-o-sin-t-tulo-1.png",
            ]
  },
  {
    id: 13,
    name: "Guinea",
    category: "pollitos",
    price: 12000,
    description: "Pollitos de 1 día, sexados. Mixtos camperos.",
    fullDescription: "Pollitos de Guinea de un día. Estos pequeños guardianes se distinguen por su plumaje moteado y su temperamento activo. Ideales para criadores que buscan una raza rústica, exótica y que ayude en el control natural de insectos y plagas en el campo.",
    image: "https://i.ibb.co/r2nW63vX/Airbrush-IMAGE-ENHANCER-1764340452290-1764340452290.png",
    images: [
        "https://i.ibb.co/r2nW63vX/Airbrush-IMAGE-ENHANCER-1764340452290-1764340452290.png",
            ]
  },
  {
    id: 14,
    name: "Guinea",
    category: "gallos",
    price: 25000,
    description: "Ideal para criaderos que buscan seguridad, rusticidad y buen rendimiento.",
    fullDescription: "Gallo de Guinea, un ave rústica y territorial, conocida por su fuerte alarma que protege a la parvada. Es ideal para criaderos de pastoreo libre, ya que su instinto natural lo hace muy eficaz contra pequeños depredadores. Su presencia asegura un ambiente más seguro para el resto de tus aves.",
    image: "https://i.ibb.co/SwThHKyh/Dise-o-sin-t-tulo-1.png",
    images: [
        "https://i.ibb.co/SwThHKyh/Dise-o-sin-t-tulo-1.png",
        "https://i.ibb.co/wNDK1M87/Captura-de-pantalla-2025-11-30-224650.jpg"
          ]
  },
  {
    id: 15,
    name: "Isa Brown",
    category: "gallinas",
    price: 20000,
    description: "Rústica, tranquila y muy ponedora, ideal para obtener huevos marrones de alta calidad.",
    fullDescription: "La gallina Isa Brown es mundialmente reconocida por su extraordinaria capacidad ponedora, siendo la elección número uno para la producción de huevos marrones en gran escala. Es un ave de carácter dócil, fácil de manejar y se adapta rápidamente a diferentes sistemas de cría. Su ciclo de producción es largo y estable.",
    image: "https://i.ibb.co/BKn6hxGg/Granja-Muny-1.png",
    images: [
        "https://i.ibb.co/BKn6hxGg/Granja-Muny-1.png",
        "https://i.ibb.co/KxBcfhB2/brown-hen-looking-42971135-473e91e5-260e-49c8-b1db-21a926b321c6.jpg"
            ]
  },
  {
    id: 16,
    name: "Isa Brown",
    category: "gallos",
    price: 20000,
    description: "Rústica, tranquila y muy ponedora, ideal para obtener huevos marrones de alta calidad.",
    fullDescription: "Gallo de la raza Isa Brown, un semental que asegura la fertilidad y mantiene las características de alta postura en la descendencia. Es robusto, con buena salud y fácil de integrar en cualquier parvada gracias a su temperamento calmado.",
    image: "https://i.ibb.co/JFxdcNrG/Airbrush-IMAGE-ENHANCER-1764341176624-1764341176624.png",
    images: [
        "https://i.ibb.co/JFxdcNrG/Airbrush-IMAGE-ENHANCER-1764341176624-1764341176624.png",
        "https://i.ibb.co/TBgfWTpp/Captura-de-pantalla-2025-11-30-225402-1b75523a-be62-4ce2-8bee-4889f7ce2f39.jpg"
            ]
  },
  {
    id: 17,
    name: "Huevos Pigmeo",
    category: "huevos",
    price: 1000,
    description: "Huevos de gallina Pigmeo, de tamaño más pequeño pero de sabor intenso.",
    fullDescription: "Estos son los huevos de nuestras gallinas Pigmeo. Son notablemente más pequeños que los huevos industriales, pero poseen una yema más grande y un sabor más concentrado. Ideales para repostería o para quienes prefieren porciones más pequeñas de huevo de altísima calidad campera.",
    image: "https://i.ibb.co/jZySzgM8/6b9932d1-113a-43b6-bdaa-4c34e2ce21ef.jpg",
    },
    {
    id: 18,
    name: "Huevos Leghorn",
    category: "huevos",
    price: 1000,
    description: "Huevos blancos, grandes y frescos. La clásica elección del criador.",
    fullDescription: "Huevos blancos de tamaño grande, puestos por nuestras gallinas Leghorn. Son conocidos por su cáscara blanca brillante y su excelente consistencia. Perfectos para el consumo diario y cualquier receta.",
    image: "https://i.ibb.co/Q7FShW72/e065a820-b6a9-4ad2-a596-c88e31d6705f.jpg",
    },
    {
    id: 19,
    name: "Pigmeo",
    category: "gallinas",
    price: 20000,
    description: "La gallina pigmeo es una raza pequeña, encantadora y muy fácil de cuidar.",
    fullDescription: "Nuestras gallinas Pigmeo son ideales como mascotas o para una producción de huevos muy personal. Su tamaño reducido no compromete su capacidad de postura, y su personalidad curiosa y amigable las hace muy populares. Requieren menos espacio y alimento que las razas grandes.",
    image: "https://i.ibb.co/B5hBPfCM/Dise-o-sin-t-tulo-1-fotor-enhance-20251128145735.jpg",
    images: [
        "https://i.ibb.co/B5hBPfCM/Dise-o-sin-t-tulo-1-fotor-enhance-20251128145735.jpg",
           ]
  },
  {
    id: 20,
    name: "Huevos Rhode Island Red",
    category: "huevos",
    price: 1000,
    description: "Huevos marrones de cáscara resistente y yema de color intenso.",
    fullDescription: "Estos huevos provienen de nuestras gallinas Rhode Island Red. Se caracterizan por su cáscara de color marrón oscuro y una yema grande y vibrante, señal de una dieta rica y natural. Son huevos grandes y robustos, ideales para el almacenamiento y el transporte seguro.",
    image: "https://i.ibb.co/jPWggTHn/wmremove-transformed.jpg",
    },
    {
    id: 21,
    name: "Huevos Marans",
    category: "huevos",
    price: 1000,
    description: "Famosos por su cáscara color 'chocolate'. Un manjar exótico.",
    fullDescription: "Los famosos 'huevos chocolate' de la raza Marans. Su coloración marrón muy oscura es su sello de identidad. No solo son estéticamente bellos, sino que su cáscara es excepcionalmente gruesa, lo que prolonga su vida útil. Son muy valorados por chefs y amantes de la gastronomía.",
    image: "https://i.ibb.co/TMPGZYzC/wmremove-transformed-1.jpg",
    },
    {
    id: 22,
    name: "Huevos Guinea",
    category: "huevos",
    price: 1000,
    description: "Huevos pequeños, ligeramente moteados. Ricos en sabor.",
    fullDescription: "Huevos puestos por las gallinas de Guinea. Son pequeños y tienen una cáscara gruesa con un ligero moteado. Poseen un sabor más fuerte e intenso que el huevo de gallina común. Son una opción gourmet y rústica para platos especiales.",
    image: "https://i.ibb.co/sp5Rv3GN/138509791-eggs-in-a-nest.jpg",
    },
    {
    id: 23,
    name: "Huevos Isa Brown",
    category: "huevos",
    price: 1000,
    description: "El estándar de oro en huevos marrones. Máxima postura y calidad.",
    fullDescription: "Huevos de la gallina Isa Brown, el referente de la industria por su consistencia, tamaño y color marrón uniforme. Es la elección perfecta si buscas un huevo de granja confiable y de alta calidad para el consumo diario. Siempre frescos y de cáscara resistente.",
    image: "https://i.ibb.co/4gMc6X5d/87751658-fresh-eggs-on-straw-in-the-market.jpg",
    },
    {
    id: 24,
    name: "Desnuda de Transilvania",
    category: "gallinas",
    price: 20000,
    description: "Gallina única y rústica, conocida por su cuello sin plumas.",
    fullDescription: "La gallina Desnuda de Transilvania es una raza robusta y muy resistente al calor gracias a su peculiar cuello sin plumas. Es una excelente ponedora de huevos marrones claros y también ofrece buen rendimiento cárnico. Su apariencia singular la hace muy llamativa y es fácil de cuidar, prosperando bien en ambientes de pastoreo.",
    image: "https://i.ibb.co/23mLLf2p/hen-cuello-desnudo-comiendo-desde-el-abrevadero-en-corral-alimentaci-n-de-aves-la-granja-dom-sticas.png",
    images: [
        "https://i.ibb.co/23mLLf2p/hen-cuello-desnudo-comiendo-desde-el-abrevadero-en-corral-alimentaci-n-de-aves-la-granja-dom-sticas.png",
        "https://i.ibb.co/hx6vmcjJ/gallina-13276076-1.png",
        "https://i.ibb.co/S7MSKQPM/Captura-de-pantalla-2025-11-30-185528.png"
    ]
  },
  {
    id: 25,
    name: "Desnuda de Transilvania",
    category: "gallos",
    price: 20000,
    description: "Gallo rústico con el distintivo cuello desnudo. Ideal para climas cálidos.",
    fullDescription: "Gallo Desnudo de Transilvania, un semental que aporta vigor y una gran tolerancia al calor a su parvada. Su genética es excelente para producir gallinas ponedoras que se adaptan a condiciones climáticas adversas. Su temperamento es generalmente tranquilo y es un ave muy resistente a las enfermedades.",
    image: "https://i.ibb.co/nsnfZMJk/Captura-de-pantalla-2025-11-30-202410.png",
    images: [
        "https://i.ibb.co/nsnfZMJk/Captura-de-pantalla-2025-11-30-202410.png",
        "https://i.ibb.co/DcNfCgL/Captura-de-pantalla-2025-11-30-203510.png",
        "https://i.ibb.co/mCCmdJdf/9c473536-a47e-4279-87bb-70cf79a0c1fa.jpg"
    ]
  },
  {
    id: 26,
    name: "Desnuda de Transilvania",
    category: "pollitos",
    price: 12000,
    description: "Pollitos de 1 día, sexados. Mixtos camperos.",
    fullDescription: "Pollitos de la raza Desnuda de Transilvania, de un día. Su característica distintiva ya es visible. Estos pollitos están destinados a crecer en aves muy resistentes, de doble propósito, y con una gran capacidad de postura, especialmente en regiones donde el calor es un factor limitante.",
    image: "https://i.ibb.co/sJWV1ksJ/2f0caf2e-b9e4-4125-aa46-5663cd6b4697.jpg",
    images: [
        "https://i.ibb.co/sJWV1ksJ/2f0caf2e-b9e4-4125-aa46-5663cd6b4697.jpg",
            ]
  },
  {
    id: 27,
    name: "Huevos Desnuda de transilvania",
    category: "huevos",
    price: 1000,
    description: "Huevos frescos de la gallina de cuello desnudo.",
    fullDescription: "Huevos de la robusta gallina Desnuda de Transilvania. Son huevos de cáscara marrón claro, consistentes y de buen tamaño. Su sabor es limpio y la yema es nutritiva, reflejando el buen estado de salud de nuestras aves criadas al aire libre.",
    image: "https://i.ibb.co/Hfv8cdF1/243004315-close-up-of-newborn-dark-cute-little-chick-next-to-hatching-egg-in-incubator-poultry-farmi.png",
    }
];

const CATEGORIES = [
  { id: 'all', name: 'Todos' },
  { id: 'gallinas', name: 'Gallinas' },
  { id: 'gallos', name: 'Gallos' },
  { id: 'pollitos', name: 'Pollitos' },
  { id: 'huevos', name: 'Huevos' },
];

export default function App() {
  const [cart, setCart] = useState([]);
  const [isCartOpen, setIsCartOpen] = useState(false);
  const [activeCategory, setActiveCategory] = useState('all');
  const [mobileMenuOpen, setMobileMenuOpen] = useState(false);
  const [showNotification, setShowNotification] = useState(false);
  
  // --- ESTADOS DE ADMINISTRACIÓN Y FIREBASE ---
  const [db, setDb] = useState(null);
  const [userId, setUserId] = useState(null);
  const [isAdmin, setIsAdmin] = useState(false);
  const [isAuthReady, setIsAuthReady] = useState(false);
  const [availabilityStatus, setAvailabilityStatus] = useState({});
  const [isConfigOpen, setIsConfigOpen] = useState(false); // Nuevo estado para el panel Admin

  const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
  
  // --- ESTADO PARA EL MODAL DE PRODUCTO ---
  const [selectedProduct, setSelectedProduct] = useState(null);
  const [isProductModalOpen, setIsProductModalOpen] = useState(false);
  const [activeImageIndex, setActiveImageIndex] = useState(0); 
  
  // ====================================================================
  // 1. CONFIGURACIÓN E INICIALIZACIÓN DE FIREBASE
  // ====================================================================
  useEffect(() => {
    // setLogLevel('debug'); // Descomentar para ver logs de Firestore en consola
    async function initFirebase() {
        try {
            const firebaseConfig = JSON.parse(__firebase_config);
            const app = initializeApp(firebaseConfig);
            const firestoreDb = getFirestore(app);
            const firebaseAuth = getAuth(app);
            setDb(firestoreDb);

            onAuthStateChanged(firebaseAuth, async (user) => {
                if (user) {
                    setUserId(user.uid);
                    // Asumimos que el usuario autenticado con el token inicial es el administrador
                    setIsAdmin(true); 
                } else {
                    setUserId(null);
                    setIsAdmin(false);
                }
                setIsAuthReady(true);
            });

            if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
                await signInWithCustomToken(firebaseAuth, __initial_auth_token);
            } else {
                await signInAnonymously(firebaseAuth);
            }
        } catch (error) {
            console.error("Error inicializando Firebase:", error);
        }
    }
    initFirebase();
  }, []);

  // ====================================================================
  // 2. ESCUCHA EN TIEMPO REAL LA DISPONIBILIDAD (Colección Pública)
  // ====================================================================
  useEffect(() => {
    if (!db || !isAuthReady) return;

    // Ruta pública para que todos puedan leer la disponibilidad
    const availabilityColRef = collection(db, 
        'artifacts', appId, 
        'public', 'data', 
        'product_availability'
    );

    const unsubscribe = onSnapshot(availabilityColRef, (snapshot) => {
        const newStatus = {};
        snapshot.forEach((doc) => {
            const data = doc.data();
            // Si el campo isAvailable es false, se establece como false, sino es true
            newStatus[doc.id] = data.isAvailable !== false; 
        });
        setAvailabilityStatus(newStatus);
    }, (error) => {
        console.error("Error al escuchar disponibilidad:", error);
    });

    return () => unsubscribe();
  }, [db, isAuthReady, appId]);

  // ====================================================================
  // 3. FUNCIÓN PARA ACTUALIZAR LA DISPONIBILIDAD (Solo Admin)
  // ====================================================================
  const toggleProductAvailability = async (productId, currentStatus) => {
      if (!db || !isAdmin) {
          console.warn("Permiso denegado. Solo el administrador puede modificar la disponibilidad.");
          return;
      }

      const docRef = doc(db, 
          'artifacts', appId, 
          'public', 'data', 
          'product_availability', String(productId)
      );

      try {
          await setDoc(docRef, { 
              isAvailable: !currentStatus,
              lastUpdated: serverTimestamp()
          }, { merge: true });
      } catch (error) {
          console.error("Error al actualizar disponibilidad:", error);
      }
  };


  // Combina los datos estáticos con el estado de disponibilidad en tiempo real
  const productsWithStatus = PRODUCTS_DATA.map(product => ({
      ...product,
      isAvailable: availabilityStatus[product.id] !== false, // Por defecto disponible si no hay estado en DB
  }));
  
  // Productos filtrados y listos para mostrar
  const filteredProducts = activeCategory === 'all' 
    ? productsWithStatus 
    : productsWithStatus.filter(p => p.category === activeCategory);


  // --- RESTO DE LAS FUNCIONES Y ESTADOS ---
  const closeProductModal = () => {
    setIsProductModalOpen(false);
    setSelectedProduct(null);
    setActiveImageIndex(0);
  };

  const openProductModal = (product) => {
    // Si el producto no está disponible, no se abre el modal, solo muestra el mensaje
    if (!product.isAvailable) return; 

    // Reinicia el índice de imagen activa al abrir
    setSelectedProduct(product);
    setActiveImageIndex(0); 
    setIsProductModalOpen(true);
  };

  const addToCart = (product) => {
    if (!product.isAvailable) return; // No permitir agregar si no está disponible

    setCart(prevCart => {
      const existingItem = prevCart.find(item => item.id === product.id);
      if (existingItem) {
        return prevCart.map(item =>
          item.id === product.id ? { ...item, quantity: item.quantity + 1 } : item
        );
      }
      return [...prevCart, { ...product, quantity: 1 }];
    });
    
    setShowNotification(true);
    setTimeout(() => setShowNotification(false), 2000);
  };

  const removeFromCart = (id) => {
    setCart(prevCart => prevCart.filter(item => item.id !== id));
  };

  const updateQuantity = (id, delta) => {
    setCart(prevCart => prevCart.map(item => {
      if (item.id === id) {
        const newQuantity = Math.max(1, item.quantity + delta);
        return { ...item, quantity: newQuantity };
      }
      return item;
    }));
  };

  const cartTotal = cart.reduce((total, item) => total + (item.price * item.quantity), 0);
  const cartCount = cart.reduce((total, item) => total + item.quantity, 0);

  const generateWhatsAppOrderLink = () => {
      if (cart.length === 0) return '#'; 
      // Filtrar productos no disponibles del carrito para el mensaje de WhatsApp
      const availableCart = cart.filter(item => item.isAvailable);

      const orderDetails = availableCart.map(item => 
          `${item.quantity} x ${item.name} ($${item.price.toLocaleString()})`
      ).join('\n');
      
      const total = availableCart.reduce((total, item) => total + (item.price * item.quantity), 0).toLocaleString();
      
      const message = `¡Hola Granja Muny! Me gustaría hacer un pedido:\n\n--- Mi Pedido ---\n${orderDetails}\n\nTotal: $${total}\n\nPor favor, confírmenme la disponibilidad y el método de pago. ¡Gracias!`;
      
      return `https://wa.me/${WHATSAPP_NUMBER}?text=${encodeURIComponent(message)}`;
  };

  const generalContactMessage = encodeURIComponent("Hola Granja Muny, me gustaría hacer una consulta general.");
  const generalWhatsAppLink = `https://wa.me/${WHATSAPP_NUMBER}?text=${generalContactMessage}`;

  const scrollToSection = (id) => {
    const element = document.getElementById(id);
    if (element) {
      element.scrollIntoView({ behavior: 'smooth' });
    }
    setMobileMenuOpen(false);
  };

  // ====================================================================
  // COMPONENTE: PANEL DE ADMINISTRACIÓN (SOLO PARA ADMIN)
  // ====================================================================
  const AdminPanel = ({ products, toggleAvailability, isOpen, onClose }) => {
    if (!isOpen) return null;

    return (
        <div className="fixed inset-0 z-[70] flex justify-end">
            <div className="absolute inset-0 bg-black/60 backdrop-blur-sm" onClick={onClose}></div>
            <div className="relative bg-white w-full max-w-lg h-full shadow-2xl flex flex-col animate-slideInRight">
                <div className="p-4 bg-orange-800 text-white flex justify-between items-center">
                    <h2 className="text-xl font-bold flex items-center gap-2">
                        <Settings size={20} /> Panel de Disponibilidad
                    </h2>
                    <button onClick={onClose} className="p-2 hover:bg-orange-700 rounded-full">
                        <X size={24} />
                    </button>
                </div>

                <div className="flex-1 overflow-y-auto p-4 space-y-3">
                    <p className="text-sm text-gray-600 mb-4 bg-yellow-50 p-3 rounded-lg border-l-4 border-yellow-500">
                        Solo tú puedes ver y modificar esta configuración. El cambio es en tiempo real.
                    </p>
                    {products.map(product => (
                        <div key={product.id} className="flex justify-between items-center bg-gray-50 p-3 rounded-lg border border-gray-100">
                            <div className='flex items-center gap-3'>
                                <img src={product.image} alt={product.name} className="w-10 h-10 object-cover rounded" />
                                <div className='flex-1'>
                                    <p className="font-semibold text-gray-800 leading-tight">{product.name}</p>
                                    <p className="text-xs text-gray-500">{product.category}</p>
                                </div>
                            </div>
                            
                            <div className="flex items-center gap-2">
                                <span className={`text-sm font-medium ${product.isAvailable ? 'text-green-600' : 'text-red-600'}`}>
                                    {product.isAvailable ? 'Disponible' : 'No Disp.'}
                                </span>
                                <button 
                                    onClick={() => toggleAvailability(product.id, product.isAvailable)}
                                    className={`p-1 rounded-full transition ${product.isAvailable ? 'text-green-600 hover:text-green-700' : 'text-gray-400 hover:text-gray-500'}`}
                                >
                                    {product.isAvailable ? <ToggleRight size={32} className="fill-green-600/30" /> : <ToggleLeft size={32} className="fill-gray-400/30" />}
                                </button>
                            </div>
                        </div>
                    ))}
                </div>
            </div>
        </div>
    );
  };


  return (
    <div className="font-sans text-gray-800 bg-amber-50 min-h-screen flex flex-col">
      
      {/* --- NAV BAR --- */}
      <nav className="bg-orange-800 text-white sticky top-0 z-50 shadow-lg">
        <div className="container mx-auto px-4 py-3 flex justify-between items-center">
          <div className="flex items-center gap-2 cursor-pointer" onClick={() => scrollToSection('hero')}>
            <div className="p-0.5 w-16 h-16 flex items-center justify-center overflow-hidden bg-white rounded-full">
               <img 
                 src={USER_LOGO_UPLOADED_ID} 
                 alt="Logo Granja Muny" 
                 className="w-full h-full object-cover rounded-full"
                 onError={(e) => {
                    e.target.onerror = null; 
                    if (e.target.src !== USER_LOGO_EXTERNAL_URL) {
                      e.target.src = USER_LOGO_EXTERNAL_URL;
                    } else {
                       e.target.replaceWith(React.createElement(Bird, { size: 40, className: "text-orange-800" }));
                    }
                 }}
               />
            </div>
            <h1 className="text-xl md:text-2xl font-bold tracking-tight">Granja Muny</h1>
          </div>

          <div className="hidden md:flex gap-8 items-center font-medium">
            <button onClick={() => scrollToSection('hero')} className="hover:text-orange-200 transition">Inicio</button>
            <button onClick={() => scrollToSection('productos')} className="hover:text-orange-200 transition">Productos</button>
            <button onClick={() => scrollToSection('nosotros')} className="hover:text-orange-200 transition">Nosotros</button>
            <button onClick={() => scrollToSection('contacto')} className="hover:text-orange-200 transition">Contacto</button>
          </div>

          <div className="flex items-center gap-4">
            {/* BOTÓN MODO ADMIN (SOLO VISIBLE PARA EL ADMIN) */}
            {isAdmin && isAuthReady && (
                <button
                    className="p-2 bg-orange-600 hover:bg-orange-700 rounded-lg transition flex items-center gap-2 text-sm font-semibold"
                    onClick={() => setIsConfigOpen(true)}
                >
                    <Settings size={20} />
                    {isConfigOpen ? 'Cerrar' : 'Admin'}
                </button>
            )}

            <button 
              className="relative p-2 hover:bg-orange-700 rounded-full transition"
              onClick={() => setIsCartOpen(true)}
            >
              <ShoppingCart size={24} />
              {cartCount > 0 && (
                <span className="absolute -top-1 -right-1 bg-yellow-500 text-orange-900 text-xs font-bold w-5 h-5 flex items-center justify-center rounded-full">
                  {cartCount}
                </span>
              )}
            </button>
            
            <button 
              className="md:hidden p-2 hover:bg-orange-700 rounded-lg"
              onClick={() => setMobileMenuOpen(!mobileMenuOpen)}
            >
              {mobileMenuOpen ? <X size={24} /> : <Menu size={24} />}
            </button>
          </div>
        </div>

        {mobileMenuOpen && (
          <div className="md:hidden bg-orange-900 px-4 py-4 space-y-3 shadow-inner">
            <button onClick={() => scrollToSection('hero')} className="block w-full text-left py-2 border-b border-orange-800">Inicio</button>
            <button onClick={() => scrollToSection('productos')} className="block w-full text-left py-2 border-b border-orange-800">Productos</button>
            <button onClick={() => scrollToSection('nosotros')} className="block w-full text-left py-2 border-b border-orange-800">Nosotros</button>
            <button onClick={() => scrollToSection('contacto')} className="block w-full text-left py-2">Contacto</button>
          </div>
        )}
      </nav>

      {/* --- CART SIDEBAR (con ajuste de disponibilidad) --- */}
      {isCartOpen && (
        <div className="fixed inset-0 z-50 flex justify-end">
          <div className="absolute inset-0 bg-black/50 backdrop-blur-sm" onClick={() => setIsCartOpen(false)}></div>
          <div className="relative bg-white w-full max-w-md h-full shadow-2xl flex flex-col animate-slideInRight">
            <div className="p-4 bg-orange-50 border-b border-orange-100 flex justify-between items-center">
              <h2 className="text-xl font-bold text-orange-900 flex items-center gap-2">
                <ShoppingCart size={20} /> Tu Pedido
              </h2>
              <button onClick={() => setIsCartOpen(false)} className="p-2 hover:bg-orange-200 rounded-full text-orange-800">
                <X size={24} />
              </button>
            </div>

            <div className="flex-1 overflow-y-auto p-4 space-y-4">
              {cart.length === 0 ? (
                <div className="text-center py-10 text-gray-500">
                  <Egg size={48} className="mx-auto mb-4 opacity-30" />
                  <p>Tu canasta está vacía.</p>
                  <p className="text-sm">¡Agrega algunos productos frescos!</p>
                </div>
              ) : (
                cart.map(item => (
                  <div key={item.id} className={`flex gap-4 items-center p-3 rounded-lg shadow-sm transition ${item.isAvailable ? 'bg-white border border-gray-100' : 'bg-red-50 border border-red-200 opacity-60'}`}>
                    <img src={item.image} alt={item.name} className="w-16 h-16 object-cover rounded-md" />
                    <div className="flex-1">
                      <h4 className={`font-semibold ${item.isAvailable ? 'text-gray-800' : 'text-red-800 line-through'}`}>{item.name}</h4>
                      <p className={`font-bold ${item.isAvailable ? 'text-orange-600' : 'text-red-600'}`}>
                        ${item.price.toLocaleString()}
                      </p>
                      {!item.isAvailable && <p className="text-xs text-red-600 font-bold mt-1">NO DISPONIBLE</p>}
                    </div>
                    
                    {item.isAvailable && (
                        <div className="flex flex-col items-end gap-2">
                          <div className="flex items-center gap-2 bg-gray-100 rounded-lg p-1">
                            <button onClick={() => updateQuantity(item.id, -1)} className="p-1 hover:bg-gray-200 rounded"><Minus size={14}/></button>
                            <span className="text-sm font-medium w-4 text-center">{item.quantity}</span>
                            <button onClick={() => updateQuantity(item.id, 1)} className="p-1 hover:bg-gray-200 rounded"><Plus size={14}/></button>
                          </div>
                          <button onClick={() => removeFromCart(item.id)} className="text-red-400 hover:text-red-600">
                            <Trash2 size={16} />
                          </button>
                        </div>
                    )}
                    {!item.isAvailable && (
                        <button onClick={() => removeFromCart(item.id)} className="text-red-600 hover:text-red-800 font-semibold text-sm">
                            Remover
                        </button>
                    )}
                  </div>
                ))
              )}
            </div>

            {cart.length > 0 && (
              <div className="p-6 bg-white border-t border-gray-100 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.1)]">
                <div className="flex justify-between items-center mb-4 text-lg">
                  <span className="font-medium text-gray-600">Total (solo disponibles):</span>
                  <span className="font-bold text-2xl text-orange-700">${cart.filter(i => i.isAvailable).reduce((total, item) => total + (item.price * item.quantity), 0).toLocaleString()}</span>
                </div>
                {/* Botón de Pedir por WhatsApp (funcional) */}
                <a 
                  href={generateWhatsAppOrderLink()}
                  target="_blank"
                  rel="noopener noreferrer"
                  className="w-full bg-green-600 text-white py-3.5 rounded-xl font-bold text-lg hover:bg-green-700 transition flex items-center justify-center gap-2 shadow-lg shadow-green-600/20"
                >
                  <Phone size={20} />
                  Pedir por WhatsApp
                </a>
              </div>
            )}
          </div>
        </div>
      )}

      {/* --- NOTIFICATION TOAST --- */}
      {showNotification && (
        <div className="fixed bottom-6 right-6 bg-green-600 text-white px-6 py-3 rounded-full shadow-2xl z-50 flex items-center gap-3 animate-bounce">
          <div className="bg-white/20 p-1 rounded-full"><Plus size={16}/></div>
          Producto agregado al carrito
        </div>
      )}

      {/* --- HERO SECTION --- */}
      <header id="hero" className="relative h-[500px] md:h-[600px] flex items-center justify-center text-center px-4">
        <div className="absolute inset-0 overflow-hidden">
          <img 
            src="https://media-public.canva.com/sDh9M/MAEyJ2sDh9M/1/tl.jpg" 
            alt="Gallinas en la granja al amanecer" 
            className="w-full h-full object-cover"
          />
          <div className="absolute inset-0 bg-gradient-to-t from-black/80 via-black/40 to-black/30"></div>
        </div>

        <div className="relative z-10 max-w-3xl text-white space-y-6">
          <div className="inline-flex items-center gap-2 bg-orange-600/90 px-4 py-1.5 rounded-full text-sm font-bold mb-2 backdrop-blur-sm">
            <Star size={14} className="fill-current" /> Calidad Premium
          </div>
          <h1 className="text-4xl md:text-6xl font-extrabold tracking-tight leading-tight">
            Criadas con Dedicación <br/><span className="text-yellow-400">para tu Granja</span>
          </h1>
          <p className="text-lg md:text-xl text-gray-200 max-w-xl mx-auto">
            Cría responsable de aves de corral y producción de huevos orgánicos. Alimentación natural, vida feliz.
          </p>
          <button 
            onClick={() => scrollToSection('productos')}
            className="mt-4 bg-yellow-500 text-orange-900 px-8 py-4 rounded-full font-bold text-lg hover:bg-yellow-400 transition transform hover:scale-105 shadow-xl"
          >
            Ver Productos
          </button>
        </div>
      </header>

      {/* --- CATEGORIES & PRODUCTS (con chequeo de disponibilidad) --- */}
      <main id="productos" className="flex-1 container mx-auto px-4 py-16">
        <div className="text-center mb-12">
          <h2 className="text-3xl font-bold text-orange-900 mb-4">Nuestros Productos</h2>
          <div className="w-20 h-1 bg-yellow-500 mx-auto mb-6 rounded-full"></div>
          
          {/* Filters */}
          <div className="flex flex-wrap justify-center gap-3">
            {CATEGORIES.map(cat => (
              <button
                key={cat.id}
                onClick={() => setActiveCategory(cat.id)}
                className={`px-6 py-2 rounded-full font-medium transition-all ${
                  activeCategory === cat.id
                    ? 'bg-orange-700 text-white shadow-lg scale-105'
                    : 'bg-white text-gray-600 hover:bg-orange-100 border border-orange-100'
                }`}
              >
                {cat.name}
              </button>
            ))}
          </div>
        </div>

        {/* Product Grid */}
        <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8">
          {filteredProducts.map(product => {
            const isAvailable = product.isAvailable;
            return (
              <div 
                key={product.id} 
                className={`bg-white rounded-2xl shadow-md transition duration-300 overflow-hidden group flex flex-col h-full border ${isAvailable ? 'hover:shadow-xl border-orange-50 cursor-pointer' : 'border-gray-200 opacity-60'}`}
                onClick={() => openProductModal(product)} 
              >
                <div className="relative h-56 overflow-hidden">
                  <img 
                    src={product.image} 
                    alt={product.name} 
                    onError={(e) => {
                        e.target.onerror = null; 
                        e.target.src="https://placehold.co/500x300/f97316/ffffff?text=Imagen+no+disponible";
                    }}
                    className={`w-full h-full object-cover transition duration-500 ${isAvailable ? 'group-hover:scale-110' : ''}`}
                  />
                  <div className="absolute top-3 right-3 bg-white/90 backdrop-blur-sm px-3 py-1 rounded-lg text-sm font-bold shadow-sm">
                    {isAvailable ? (
                        <span className="text-orange-800">${product.price.toLocaleString()}</span>
                    ) : (
                        <span className="text-red-600">No Disp.</span>
                    )}
                  </div>
                </div>
                
                <div className="p-5 flex-1 flex-col flex">
                  <div className="mb-2 text-xs font-bold text-orange-600 uppercase tracking-wide">
                    {product.category}
                  </div>
                  <h3 className="text-xl font-bold text-gray-800 mb-2 leading-tight">{product.name}</h3>
                  <p className="text-gray-500 text-sm mb-6 line-clamp-2 flex-1">
                    {product.description}
                  </p>
                  
                  {isAvailable ? (
                    <button 
                      onClick={(e) => {
                        e.stopPropagation(); 
                        addToCart(product);
                      }}
                      className="w-full bg-orange-100 text-orange-800 py-3 rounded-xl font-bold hover:bg-orange-800 hover:text-white transition flex items-center justify-center gap-2 group/btn"
                    >
                      <ShoppingCart size={18} className="group-hover/btn:scale-110 transition" />
                      Agregar
                    </button>
                  ) : (
                    <div className="w-full bg-red-500 text-white py-3 rounded-xl font-bold flex items-center justify-center gap-2">
                      <X size={18} />
                      Agotado
                    </div>
                  )}
                </div>
              </div>
            );
          })}
        </div>
      </main>

      {/* --- INFO / ABOUT SECTION --- */}
      <section id="nosotros" className="bg-orange-900 text-white py-16 relative overflow-hidden">
        <div className="absolute top-0 right-0 p-12 opacity-5">
            <Bird size={400} />
        </div>
        <div className="container mx-auto px-4 grid md:grid-cols-2 gap-12 items-center relative z-10">
          <div>
            <h2 className="text-3xl font-bold mb-6">Granja Muny</h2>
            <p className="text-orange-100 mb-6 leading-relaxed">
              Somos una pequeña empresa familiar dedicada a la avicultura sostenible. Creemos en el trato ético animal y en la alimentación natural sin hormonas ni aditivos.
            </p>
          </div>
          <div className="bg-white/10 p-2 rounded-2xl backdrop-blur-sm">
             <img 
              src="https://i.ibb.co/hJp74gG3/Airbrush-IMAGE-ENHANCER-1764344601529-1764344601529.jpg" 
              alt="Granjero con gallina" 
              className="rounded-xl shadow-2xl w-full"
            />
          </div>
        </div>
      </section>

      {/* --- FOOTER / CONTACT --- */}
      <footer id="contacto" className="bg-gray-900 text-gray-300 py-12 border-t border-gray-800">
        <div className="container mx-auto px-4 grid md:grid-cols-3 gap-8 text-center md:text-left">
          
          <div>
            <div className="flex items-center justify-center md:justify-start gap-2 text-white mb-4">
               <img 
                 src={USER_LOGO_UPLOADED_ID} 
                 alt="Logo Granja Muny" 
                 className="w-12 h-12 rounded-full object-cover"
                 onError={(e) => {
                    e.target.onerror = null; 
                    if (e.target.src !== USER_LOGO_EXTERNAL_URL) {
                      e.target.src = USER_LOGO_EXTERNAL_URL;
                    } else {
                       e.target.replaceWith(React.createElement(Bird, { size: 40, className: "text-orange-800" }));
                    }
                 }}
               />
               <h3 className="text-xl font-bold">Granja Muny</h3>
            </div>
            <p className="text-sm text-gray-400">
              Trayendo lo mejor del campo a tu hogar. Calidad garantizada en cada producto.
            </p>
          </div>

          <div>
            <h4 className="text-white font-bold mb-4">Contacto</h4>
            <div className="space-y-3 flex flex-col items-center md:items-start">
              <a href={`tel:${WHATSAPP_NUMBER}`} className="flex items-center gap-2 hover:text-yellow-400 transition">
                <Phone size={18} /> +54 9 2215 34-4675
              </a>
              <div className="flex items-center gap-2">
                <MapPin size={18} /> Gonnet, La Plata, Argentina
              </div>
            </div>
          </div>

          <div>
            <h4 className="text-white font-bold mb-4">Síguenos</h4>
            <div className="flex justify-center md:justify-start gap-4">
              <a 
                href="https://www.instagram.com/granjamuni/"
                target="_blank" 
                rel="noopener noreferrer" 
                className="bg-gray-800 p-2 rounded-full hover:bg-pink-600 hover:text-white transition"
              >
                <Instagram size={20}/>
              </a>
            </div>
            <a 
              href={generalWhatsAppLink}
              target="_blank"
              rel="noopener noreferrer"
              className="mt-6 w-full bg-green-600 text-white py-2 rounded-lg font-bold hover:bg-green-700 transition flex items-center justify-center gap-2"
            >
              <Phone size={18} /> Contactar por WhatsApp
            </a>
          </div>
          
        </div>
        <div className="container mx-auto px-4 mt-8 pt-8 border-t border-gray-800 text-center text-sm text-gray-500">
          © {new Date().getFullYear()} Granja Muny. Todos los derechos reservados.
        </div>
      </footer>
      
      {/* --- PRODUCT DETAIL MODAL --- */}
      {isProductModalOpen && selectedProduct && (
          <div className="fixed inset-0 z-[60] flex items-center justify-center p-4">
              <div 
                  className="absolute inset-0 bg-black/70 backdrop-blur-sm" 
                  onClick={closeProductModal}
              ></div>
              
              <div className="relative bg-white rounded-2xl shadow-2xl w-full max-w-4xl max-h-[90vh] overflow-y-auto animate-fade-in-up md:grid md:grid-cols-2">
                  
                  {/* Sección de Imagen y Galería */}
                  <div className="md:h-full h-auto overflow-hidden relative flex flex-col">
                      {/* Imagen Principal */}
                      <div className="h-80 md:h-[400px] overflow-hidden">
                          <img 
                              src={selectedProduct.images ? selectedProduct.images[activeImageIndex] : selectedProduct.image} 
                              alt={selectedProduct.name} 
                              className="w-full h-full object-cover transition duration-300"
                              onError={(e) => {
                                  e.target.onerror = null; 
                                  e.target.src="https://placehold.co/800x600/f97316/ffffff?text=Imagen+no+disponible";
                              }}
                          />
                      </div>

                      {/* Miniaturas de la Galería 
                        * SOLO SE MUESTRAN SI HAY MÁS DE UNA IMAGEN EN EL ARRAY 'images'
                      */}
                      {selectedProduct.images && selectedProduct.images.length > 1 && (
                          <div className="p-4 bg-gray-50 flex gap-3 overflow-x-auto border-t border-gray-100 flex-shrink-0">
                              {selectedProduct.images.map((imgUrl, index) => (
                                  <img
                                      key={index}
                                      src={imgUrl}
                                      alt={`${selectedProduct.name} - Vista ${index + 1}`}
                                      className={`w-16 h-16 object-cover rounded-md cursor-pointer transition ring-2 ${
                                          index === activeImageIndex ? 'ring-orange-600 ring-offset-2' : 'ring-transparent hover:ring-gray-300'
                                      }`}
                                      onClick={() => setActiveImageIndex(index)}
                                      onError={(e) => {
                                          e.target.onerror = null; 
                                          e.target.src="https://placehold.co/64x64/9CA3AF/ffffff?text=X";
                                      }}
                                  />
                              ))}
                          </div>
                      )}

                      {/* Botón de Cerrar */}
                      <button 
                          onClick={closeProductModal} 
                          className="absolute top-4 right-4 bg-white/70 backdrop-blur p-2 rounded-full text-gray-800 hover:bg-white transition z-10 shadow-lg"
                      >
                          <X size={20} />
                      </button>
                  </div>

                  {/* Sección de Detalles y Descripción */}
                  <div className="p-6 md:p-8 space-y-6 flex flex-col justify-between">
                      <div>
                          <span className="text-sm font-bold text-orange-600 uppercase tracking-wider mb-2 block">
                              {selectedProduct.category}
                          </span>
                          <h2 className="text-3xl md:text-4xl font-extrabold text-orange-900 mb-4">
                              {selectedProduct.name}
                          </h2>
                          
                          <p className="text-gray-600 text-lg leading-relaxed border-t pt-4">
                              {/* AQUÍ SE USA fullDescription, con fallback a description */}
                              {selectedProduct.fullDescription || selectedProduct.description}
                          </p>

                          <div className="mt-6 p-4 bg-orange-50 rounded-lg">
                              <h3 className="text-2xl font-bold text-orange-700">
                                  ${selectedProduct.price.toLocaleString()}
                              </h3>
                              <p className="text-sm text-gray-500 mt-1">
                                  Precio por unidad, sujeto a disponibilidad.
                              </p>
                          </div>
                      </div>

                      <div className="flex flex-col space-y-3 pt-4 border-t">
                          {selectedProduct.isAvailable ? (
                              <button 
                                  onClick={() => {
                                      addToCart(selectedProduct);
                                      closeProductModal(); 
                                  }}
                                  className="w-full bg-yellow-500 text-orange-900 py-3 rounded-xl font-bold text-lg hover:bg-yellow-400 transition flex items-center justify-center gap-2 shadow-md"
                              >
                                  <ShoppingCart size={20} />
                                  Agregar al Pedido
                              </button>
                          ) : (
                              <div className="w-full bg-red-500 text-white py-3 rounded-xl font-bold text-lg flex items-center justify-center gap-2 shadow-md opacity-70 cursor-default">
                                  <X size={20} />
                                  Producto No Disponible
                              </div>
                          )}
                          <button 
                              onClick={closeProductModal}
                              className="w-full text-gray-500 border border-gray-300 py-3 rounded-xl font-medium hover:bg-gray-100 transition"
                          >
                              Continuar Comprando
                          </button>
                      </div>
                  </div>
              </div>
          </div>
      )}
      
      {/* Renderizar el Panel de Administración */}
      <AdminPanel
          products={productsWithStatus}
          toggleAvailability={toggleProductAvailability}
          isOpen={isConfigOpen}
          onClose={() => setIsConfigOpen(false)}
      />

    </div>
  );
}
